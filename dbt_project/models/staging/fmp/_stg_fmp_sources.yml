# requires you install external tables plugin with 'dbt deps'
# then to stage external tables, run 'dbt run-operation stage_external_sources'
version: 2

sources:
  - name: fmp_external_source # This is the source name you'll use in ref() or source()
    database: public-company-overview
    schema: pco_dataset
    loader: gcloud storage
    tables:
      - name: stg_fmp__hist_ticker_daily # Name of the BQ external table
        description: "External table for FMP hist ticker CSV files from GCS."
        external:
          location: "gs://dbt-testing/fmp/hist_ticker/daily/*.csv" # Path to your CSV files
          options:
            format: csv 
            skip_leading_rows: 1 
        columns: #External read as string, then reformat in further staging step
          - name: symbol
            data_type: STRING
          - name: date
            data_type: STRING
          - name: open
            data_type: STRING
          - name: high
            data_type: STRING
          - name: low
            data_type: STRING
          - name: close
            data_type: STRING
          - name: volume
            data_type: STRING
          - name: change
            data_type: STRING
          - name: changePercent
            data_type: STRING
          - name: vwap
            data_type: STRING
      - name: stg_fmp__tickers_ext 
        external:
          location: "gs://dbt-testing/fmp/tickers/*.csv" 
          options:
            format: csv 
            skip_leading_rows: 1 
            allow_quoted_newlines: true
        columns:
          - name: symbol
            data_type: STRING
          - name: name
            data_type: STRING
          - name: price
            data_type: STRING
          - name: exchange
            data_type: STRING
          - name: exchangeShortName
            data_type: STRING
          - name: type
            data_type: STRING
      - name: stg_fmp__exchanges_ext 
        external:
          location: "gs://dbt-testing/fmp/exchanges/*.csv" 
          options:
            format: csv 
            skip_leading_rows: 1 
        columns:
          - name: exchange
            data_type: STRING

